# ModelHub-backend 启动指南

## 前置要求

1. **Python 环境**: Python 3.10+
2. **数据库**: MySQL（已配置在 config.py 中）
3. **Redis**: （可选，如果使用缓存功能）
4. **ChromaDB**: 向量数据库（本地运行或远程服务）

## 启动步骤

### 方式一：使用 Conda 环境（推荐）

如果你有 `environment.yml` 文件，可以使用 Conda 创建环境：

```bash
# 创建 conda 环境
conda env create -f environment.yml

# 激活环境
conda activate ModelHUb

# 启动服务
python app.py
```

### 方式二：使用 pip 安装依赖

```bash
# 创建虚拟环境（可选但推荐）
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动服务
python app.py
```

## 配置说明

### 1. 数据库配置

项目使用 MySQL 数据库，配置在 `app/config.py` 中。默认配置：
- 主机: `rm-bp1u3u9qdre6uw988po.mysql.rds.aliyuncs.com`
- 端口: `3306`
- 数据库: `modelhub`
- 用户名: `root`
- 密码: `ModelHub@135246`

**修改配置方式**：
- 创建 `.env` 文件在项目根目录
- 或直接修改 `app/config.py` 中的配置

`.env` 文件示例：
```env
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=modelhub
DB_USERNAME=root
DB_PASSWORD=your_password
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
EMBEDDING_MODEL=text-embedding-v3
EMBEDDING_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
EMBEDDING_API_KEY=your-api-key
```

### 2. ChromaDB 配置

ChromaDB 用于向量数据库功能，默认配置：
- 主机: `localhost`
- 端口: `8000`

如果使用远程 ChromaDB 服务，修改 `app/config.py` 中的 `CHROMA_SERVER_HOST`。

### 3. 目录结构

确保以下目录存在（首次运行会自动创建）：
- `uploads/` - 用户上传文件
- `finetuning/` - 微调任务数据
- `model/` - 本地模型存储
- `data/vector_docs/` - 向量文档存储
- `chroma_data/` - ChromaDB 数据

## 启动服务

### 基本启动

```bash
python app.py
```

服务将在以下地址启动：
- HTTP API: `http://localhost:5000`
- WebSocket: `ws://localhost:5000`

### 自定义端口和主机

修改 `app.py` 最后一行：
```python
socketio.run(app, debug=True, host='0.0.0.0', port=5000)
```

## 验证启动

启动成功后，你应该看到类似输出：
```
客户端连接成功
 * Running on http://0.0.0.0:5000
```

### 测试 API

可以使用以下方式测试：

1. **健康检查**（如果有）：
   ```bash
   curl http://localhost:5000/
   ```

2. **查看模型列表**：
   ```bash
   curl http://localhost:5000/model/modelinfo/getlist
   ```

## 常见问题

### 1. 数据库连接失败

- 检查 MySQL 服务是否运行
- 验证数据库配置信息是否正确
- 确认数据库用户有足够权限

### 2. 依赖安装失败

- 确保 Python 版本 >= 3.10
- 某些包（如 `mysqlclient`）可能需要系统依赖
  - Windows: 可能需要安装 MySQL Connector/C
  - Linux: `sudo apt-get install default-libmysqlclient-dev`
  - Mac: `brew install mysql`

### 3. ChromaDB 连接失败

- 如果使用本地 ChromaDB，确保服务已启动
- 检查 `chroma_data/` 目录权限

### 4. 端口被占用

修改 `app.py` 中的端口号，或关闭占用端口的程序。

## 开发模式

默认启动为调试模式（`debug=True`），会自动重载代码更改。

生产环境建议：
```python
socketio.run(app, debug=False, host='0.0.0.0', port=5000)
```

## 下一步

启动成功后，你可以：
1. 访问 API 端点进行测试
2. 连接前端应用（默认允许 `http://localhost:5173`）
3. 查看 API 文档（如果有）
4. 开始使用模型管理、对话、向量数据库等功能


